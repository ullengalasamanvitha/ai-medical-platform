<!DOCTYPE html>
<html>
<head>
    <title>Transactions</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="dashboard-page">

<header class="top-nav">
    <div class="logo">AI Medical Platform</div>
    <div class="nav-right">
        <a href="/transaction/dashboard" class="btn small">Dashboard</a>
        <a href="/logout" class="logout">Logout</a>
    </div>
</header>

<main>

<div class="table-container">
    <h2 class="table-title">Transactions</h2>
    <p class="sub-text">Review and verify pending payment transactions.</p>

    <table class="data-table">
        <thead>
            <tr>
                <th style="width:10%">ID</th>
                <th style="width:15%">Patient</th>
                <th style="width:15%">Amount</th>
                <th style="width:15%">Status</th>
                <th style="width:20%">Screenshot</th>
                <th style="width:35%; text-align:center;">Action</th>
            </tr>
        </thead>

        <tbody>
        {% for payment, patient in payments %}
        <tr>
            <td>{{ payment.id }}</td>
            <td>{{ patient.name }}</td>
            <td>₹{{ payment.final_amount }}</td>
            <td>{{ payment.status }}</td>
            <td style="text-align:center;">
                {% if payment.screenshot %}
                    <a href="/static/uploads/{{ payment.screenshot }}">
                        <img src="/static/uploads/{{ payment.screenshot }}" class="thumb">
                    </a>
                {% else %}
                    Not uploaded
                {% endif %}
            </td>

            <td class="action-cell">

            {% if payment.status == "PENDING" %}

                <!-- VERIFY UTR -->
                <form method="post" action="/transaction/verify-payment" style="margin-top:8px;">
                    <input type="hidden" name="payment_id" value="{{ payment.id }}">
                    <input type="hidden" name="action" value="verify">

                    <input type="text"
                        name="utr"
                        placeholder="Enter UTR"
                        required>

                    <button type="submit" class="btn small">Verify UTR</button>
                </form>


                {% if payment.utr_verified %}
                    <div class="success-text">UTR Verified</div>

                    <div class="action-buttons">
                        <form method="post" action="/transaction/verify-payment">
                            <input type="hidden" name="payment_id" value="{{ payment.id }}">
                            <input type="hidden" name="action" value="approve">
                            <button class="btn small">Approve</button>
                        </form>

                        <form method="post" action="/transaction/verify-payment">
                            <input type="hidden" name="payment_id" value="{{ payment.id }}">
                            <input type="hidden" name="action" value="reject">
                            <button class="btn danger small">Reject</button>
                        </form>
                    </div>
                {% endif %}

            {% else %}
                —
            {% endif %}

            </td>
        </tr>
        {% endfor %}
        </tbody>

    </table>

    <div style="margin-top:25px;">
        <a href="/transaction/dashboard" class="btn secondary">
            ← Back to Dashboard
        </a>
    </div>
</div>

</main>
</body>
</html>
